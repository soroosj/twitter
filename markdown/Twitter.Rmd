----
   title: "Twitter Analysis"
   author: "Joel Soroos"
   date: "November 2, 2020"
   output: html_document 
---


### 1a. Source tweets
```{r source, warning = TRUE, results = FALSE, message = FALSE}

   library (rtweet)
   library (tidyverse)
   library (lubridate)

   tweets_raw <- get_timeline("soroosj", n=1000)
   
   tweets <- tweets_raw %>%
      filter (is_retweet == FALSE) %>%
      rename (
         likes = favorite_count,
         retweets = retweet_count,
         created = created_at
         ) %>%
      mutate (
         text_length = str_length(text),
         text = str_sub(text,1,60),
         created = as.Date(created),
         year = year(created)
         ) %>% 
      select (text, year, likes, retweets, created)
```


###1b. Source followers
```{r}

  followers <- "soroosj" %>%
      get_followers() %>%
      pull (user_id) %>%
      lookup_users () %>%
      select (screen_name, name, location, followers_count) %>%
      arrange (-followers_count) %>%
      rowid_to_column("rank")
```
 

### 2a. Visualize - top liked tweets
```{r chart_likes, warning = TRUE, message = FALSE}

   library (gt)

   tweets %>%
      arrange (-likes, -retweets) %>%
      head (10) %>%
      rowid_to_column("rank") %>%
      select (-year) %>%
      relocate (rank) %>%
      gt () 
```


### 2b. Visualize - top retweets
```{r chart_retweet, warning = TRUE, message = FALSE}

   tweets %>%
      arrange (-retweets, -likes) %>%
      head (10) %>%
      rowid_to_column("rank") %>%
      select (rank, text, retweets, likes, created) %>%
      gt ()
```


### 2c. Visualize - tweets by year
```{r chart_year}

   tweets %>%
      group_by (year) %>%
      summarize (
         n = n (),
         likes = sum(likes),
         retweets = sum (retweets)
         ) %>%
      mutate(likes_per_tweet = round(likes/n,2)) %>%
      arrange (-year) %>%
      gt () 
```


### 2d.  Visualize - top followers
```{r}

   followers %>%
      head (10) %>%
      select (rank, name, location, followers_count) %>%
      gt () %>%
         fmt_number (columns = vars(followers_count), use_seps = T, decimals = 0)
```


### 2e.  Visualize - top followers map
```{r}

   library (ggmap)
   register_google(key = Sys.getenv("GOOGLE_MAPS_API"))

   followers_geo <- followers %>%
      mutate_geocode (location)
```